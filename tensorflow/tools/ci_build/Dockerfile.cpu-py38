FROM ubuntu:16.04

LABEL maintainer="Gauri Deshpande <gauri1.deshpande@intel.com>"

# Copy and run the install scripts.
COPY install/*.sh /install/
RUN /install/install_bootstrap_deb_packages.sh
RUN add-apt-repository -y ppa:openjdk-r/ppa && \
   add-apt-repository -y ppa:george-edison55/cmake-3.x
RUN /install/install_deb_packages.sh

# Install gcc 7
RUN add-apt-repository ppa:ubuntu-toolchain-r/test
RUN apt update
RUN apt -y install gcc-7 g++-7
RUN update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 700 \
                         --slave /usr/bin/g++ g++ /usr/bin/g++-7

# Install Python 3.8
# libffi-dev is needed for ctypes module of python3.8
RUN apt install libffi-dev
# libsqlite3-dev is needed for module named '_sqlite3'
RUN apt install libsqlite3-dev
RUN chmod 777 /install/install_python38.sh
RUN /install/install_python38.sh
RUN update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.8 0
RUN python3 -V
RUN /install/install_pip_packages_by_version.sh pip3

RUN /install/install_bazel.sh
RUN /install/install_proto3.sh
RUN /install/install_buildifier.sh
RUN /install/install_auditwheel.sh
RUN /install/install_golang.sh
# Set up the master bazelrc configuration file.
COPY install/.bazelrc /etc/bazel.bazelrc
